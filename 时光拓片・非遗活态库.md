# 														<u>时光拓片・非遗活态库</u>

## **一、项目概述**

### **1. 项目目标**

搭建一个集非遗知识传播、文创产品交易、匠人社区为一体的综合性平台，通过技术手段实现非遗文化的活态传承与现代转化。具体目标：

- **功能目标**：实现用户系统、知识库、商品交易、数据爬取四大核心模块
- **技术目标**：掌握前后端分离架构，完成从数据爬取到容器化部署的全流程开发
- **交付目标**：8 周内上线可访问的 Demo，包含 100 + 非遗项目数据、20 + 文创商品及完整用户体验流程

### **2. 项目愿景**

成为非遗文化与现代生活的桥梁，让传统技艺通过数字化手段走进大众，助力非遗产业化发展。

## **二、技术栈与架构设计**

### **1. 技术栈选型**

| **模块**     | **技术选型**                                 | **说明**                                                  |
| ------------ | -------------------------------------------- | --------------------------------------------------------- |
| **前端**     | Vue.js + Axios + Vuex + Element-UI           | 组件化开发，实现响应式布局与复杂状态管理                  |
| **后端**     | Flask + Flask-RESTful + Flask-JWT-Extended   | 纯 API 后端，提供 RESTful 接口与 JWT 认证                 |
| **数据库**   | MySQL（SQLAlchemy） + MongoDB（MongoEngine） | 结构化数据（用户 / 订单）与非结构化数据（知识库）分离存储 |
| **爬虫**     | Scrapy + Requests + ProxyPool                | 批量爬取非遗数据，支持反爬策略（代理 IP、随机请求头）     |
| **部署**     | Docker + Nginx + Gunicorn + Let's Encrypt    | 容器化部署，实现前后端分离与 HTTPS 加密                   |
| **辅助工具** | Swagger + Postman + Mock.js + Git            | 接口文档、测试、数据模拟与版本控制                        |

## **三、分阶段学习计划（8 周，每日 4-5 小时）**

### **阶段 1：基础夯实期（第 1-2 周）**

#### **目标：掌握核心技术基础，完成环境搭建**

##### **第 1 周：前端基础与 Vue.js 实战**

| **时间** | **学习内容**                                | **实践任务**                                                 | **资源 / 工具**                       |
| -------- | ------------------------------------------- | ------------------------------------------------------------ | ------------------------------------- |
| Day 1-2  | Vue.js 核心语法（组件、生命周期、模板语法） | 开发 Header/Footer 组件，实现页面跳转（Home/About 页）       | Vue 官方文档、《Vue.js 实战》         |
| Day 3-4  | Vue Router 与 Axios 基础                    | 搭建非遗列表页，通过 Axios 调用 Mock 数据（使用 Mock.js 生成 10 条项目数据） | Vue Router 文档、Axios 官网           |
| Day 5-6  | Vuex 状态管理与 Element-UI 组件库           | 实现用户登录状态全局管理，集成登录 / 注册表单组件            | Vuex 文档、Element-UI 官方示例        |
| Day 7    | 响应式设计与移动端适配                      | 用 Flexbox/Grid 实现移动端适配，测试不同屏幕尺寸显示效果     | Bootstrap 官网、CSS-Tricks 响应式指南 |

##### **第 2 周：后端基础与 Flask API 开发**

| **时间** | **学习内容**                       | **实践任务**                                                 | **资源 / 工具**                     |
| -------- | ---------------------------------- | ------------------------------------------------------------ | ----------------------------------- |
| Day 1-2  | Flask 核心（路由、蓝图、配置管理） | 初始化 Flask 项目，实现健康检查接口（`/health`返回`{"status": "ok"}`） | Flask 官方文档、《Flask Web 开发》  |
| Day 3-4  | SQLAlchemy 与 MySQL 建模           | 设计用户表（`User`）与商品表（`Product`），实现注册接口（`/api/register`） | SQLAlchemy 文档、Navicat 数据库工具 |
| Day 5-6  | Flask-RESTful 与 JWT 认证          | 实现登录接口（返回 JWT Token），添加`@jwt_required`保护路由  | Flask-RESTful 文档、JWT.io 教程     |
| Day 7    | Swagger 接口文档生成               | 用`flask-restx`自动生成 API 文档，包含用户模块所有接口描述   | Swagger UI 官网、Postman 测试集合   |

### **阶段 2：模块开发期（第 3-5 周）**

#### **目标：完成核心模块开发，实现前后端联调**

##### **第 3 周：爬虫与知识库模块**

| **时间** | **学习内容**           | **实践任务**                                                 | **资源 / 工具**                               |
| -------- | ---------------------- | ------------------------------------------------------------ | --------------------------------------------- |
| Day 1-3  | Scrapy 框架与反爬策略  | 爬取中国非遗网 100 条项目数据，处理反爬（代理 IP、随机请求头） | Scrapy 官方文档、ProxyPool 开源项目           |
| Day 4-5  | MongoDB 建模与数据清洗 | 设计知识库文档模型（`Article`），清洗爬取数据（去除 HTML 标签、标准化分类） | MongoEngine 文档、PyCharm 调试工具            |
| Day 6-7  | 知识库接口与前端对接   | 后端实现分类查询接口（`/api/articles?category=剪纸`），前端开发详情页并渲染内容 | React-Markdown 库、MongoDB Compass 可视化工具 |

##### **第 4 周：商品模块与支付对接**

| **时间** | **学习内容**                  | **实践任务**                                                 | **资源 / 工具**                          |
| -------- | ----------------------------- | ------------------------------------------------------------ | ---------------------------------------- |
| Day 1-2  | 商品表设计与分页查询          | MySQL 添加商品 SKU 字段，实现商品列表分页接口（`/api/products?page=1&size=20`） | SQL 优化指南、EXPLAIN 分析工具           |
| Day 3-4  | 购物车状态管理与 Session 存储 | 前端用 Vuex 实现购物车增删改查，后端设计购物车接口（`/api/cart`） | Vuex 官方示例、SessionStorage 文档       |
| Day 5-7  | 支付宝沙箱环境对接            | 申请沙箱账号，实现支付创建接口（`/api/payment/create`），跳转收银台页面 | 支付宝开放平台文档、Postman 支付测试用例 |

##### **第 5 周：用户系统与权限控制**

| **时间** | **学习内容**           | **实践任务**                                                 | **资源 / 工具**                        |
| -------- | ---------------------- | ------------------------------------------------------------ | -------------------------------------- |
| Day 1-2  | JWT Refresh Token 机制 | 实现 Token 续期接口（`/api/refresh`），处理 Token 过期逻辑   | Flask-JWT-Extended 文档、RFC 7519 标准 |
| Day 3-4  | 多角色权限控制         | 添加管理员角色，实现接口权限校验（如只有管理员可访问`/api/admin`） | 权限设计最佳实践、Flask-HTTPAuth 库    |
| Day 5-7  | 前端用户流程闭环测试   | 测试注册→登录→添加商品→下单→支付全流程，修复跨域问题（配置 Nginx 代理） | Cypress 自动化测试、浏览器开发者工具   |

### **阶段 3：优化与部署期（第 6-8 周）**

#### **目标：性能优化、安全加固与线上部署**

##### **第 6 周：性能与安全优化**

| **时间** | **学习内容**                      | **实践任务**                                                 | **资源 / 工具**                        |
| -------- | --------------------------------- | ------------------------------------------------------------ | -------------------------------------- |
| Day 1-2  | 前端性能优化（懒加载 / 图片压缩） | 实现路由懒加载与图片 WebP 格式转换，Lighthouse 审计优化至 85+ | Webpack 图片压缩插件、Lighthouse 报告  |
| Day 3-4  | 后端缓存与索引优化                | Redis 缓存热门商品详情，MySQL 添加联合索引（`category_id+price`） | Redis 官方文档、MySQL 索引设计指南     |
| Day 5-7  | 安全加固（XSS/SQL 注入防御）      | 前端输入过滤，后端用 Marshmallow 校验参数，开启 HTTPS 强制跳转 | OWASP 安全指南、Let's Encrypt 证书申请 |

##### **第 7 周：容器化部署与联调**

| **时间** | **学习内容**             | **实践任务**                                                 | **资源 / 工具**                      |
| -------- | ------------------------ | ------------------------------------------------------------ | ------------------------------------ |
| Day 1-3  | Docker 基础与镜像构建    | 编写前后端 Dockerfile，打包成镜像（前端 Nginx 镜像，后端 Gunicorn 镜像） | Docker 官方文档、Docker Hub 仓库管理 |
| Day 4-5  | Nginx 反向代理与负载均衡 | 配置 Nginx 实现前后端路由分发，测试多容器并发访问（模拟 50 用户并发） | Nginx 配置指南、JMeter 压力测试工具  |
| Day 6-7  | 全链路联调与日志系统     | 修复部署环境跨域问题，添加接口调用日志（记录 IP、时间、响应状态） | ELK 日志系统、Docker Compose 编排    |

##### **第 8 周：测试、交付与复盘**

| **时间** | **学习内容**       | **实践任务**                                                 | **资源 / 工具**                |
| -------- | ------------------ | ------------------------------------------------------------ | ------------------------------ |
| Day 1-3  | 功能测试与安全审计 | 用 Selenium 测试用户流程，sqlmap 检测 SQL 注入漏洞，输出《安全审计报告》 | Selenium 官网、sqlmap 开源工具 |
| Day 4-5  | 文档整理与代码优化 | 编写《API 接口文档》《运维手册》，优化代码注释至覆盖率 90%   | Swagger 导出 PDF、Git 提交规范 |
| Day 6-7  | 正式上线与项目复盘 | 部署至阿里云 ECS，监控服务器性能（CPU / 内存 / 网络），召开复盘会总结经验教训 | 阿里云控制台、腾讯云监控服务   |

## **四、创作过程（分模块开发详解）**

### **1. 数据爬取模块（第 2-3 周）**

#### **1.1 爬取策略**

- **目标网站**：中国非遗网（层级结构：首页→非遗名录→项目详情页）

- 反爬措施

  - 代理 IP 池：使用`Proxy360`获取免费代理，每 50 次请求更换 IP
- 随机请求头：通过`fake_useragent`生成 Chrome/Safari 等浏览器 User-Agent
  - 智能休眠：`time.sleep(random.uniform(2, 5))`避免高频请求

#### **1.2 核心代码（Scrapy Spider）**

python

```python
# ih_spider/spiders/ihchina.py  
import scrapy  
from fake_useragent import UserAgent  
from ih_spider.items import HeritageItem  

class IHChinaSpider(scrapy.Spider):  
    name = "ihchina"  
    start_urls = ["http://www.ihchina.cn/nonmaterial"]  

    def parse(self, response):  
        # 解析项目列表页  
        for item in response.css('div.list-item'):  
            detail_url = item.css('a::attr(href)').get()  
            yield scrapy.Request(detail_url, callback=self.parse_detail, headers=self.get_headers())  

    def parse_detail(self, response):  
        # 解析详情页  
        item = HeritageItem()  
        item['title'] = response.css('h1.title::text').get().strip()  
        item['category'] = response.css('div.tags a::text').getall()  
        item['content'] = ''.join(response.css('div.content *::text').getall()).strip()  
        item['images'] = [urljoin(response.url, img) for img in response.css('div.image img::attr(src)').getall()]  
        yield item  

    def get_headers(self):  
        # 生成随机请求头  
        ua = UserAgent()  
        return {'User-Agent': ua.random}  
```

#### **1.3 数据清洗与入库**

- 清洗逻辑

  - 去除内容中的空白符与特殊符号：`re.sub(r'\s+', ' ', content)`
- 图片链接转为绝对路径：`urljoin(response.url, img_url)`
  
- 存储结构（MongoDB）

  json

  ```json
{  
      "_id": ObjectId(),  
    "title": "剪纸（蔚县剪纸）",  
      "category": ["传统美术", "剪纸"],  
    "content": "蔚县剪纸又称窗花，是河北省蔚县的传统民间艺术...",  
      "images": ["http://xxx.jpg", "http://yyy.jpg"],  
    "crawl_time": "2025-04-10T15:30:00Z"  
  }  
```

### **2. 知识库模块（第 3-4 周）**

#### **2.1 后端实现（Flask-RESTful）**

python

```python
# backend/app/resources/article.py  
from flask_restful import Resource, reqparse  
from models.article import ArticleModel  
from flask_jwt_extended import jwt_required  

class ArticleList(Resource):  
    def get(self):  
        category = reqparse.RequestParser().add_argument('category').parse_args().get('category')  
        if category:  
            articles = ArticleModel.objects(category=category).order_by('-crawl_time')  
        else:  
            articles = ArticleModel.objects.all()  
        return {'articles': [a.to_dict() for a in articles], 'count': len(articles)}  

class ArticleDetail(Resource):  
    @jwt_required()  
    def get(self, article_id):  
        article = ArticleModel.objects(id=article_id).first()  
        if not article:  
            return {'message': 'Article not found'}, 404  
        return article.to_dict()  
```

#### **2.2 前端组件（Vue.js）**

vue

```vue
<!-- frontend/src/views/ArticleDetail.vue -->  
<template>  
  <div class="article-container">  
    <h1>{{ article.title }}</h1>  
    <div class="categories">分类：{{ article.category.join(' / ') }}</div>  
    <div v-html="article.content"></div>  
    <img v-for="img in article.images" :key="img" :src="img" class="article-image">  
  </div>  
</template>  

<script>  
export default {  
  props: ['articleId'],  
  data() {  
    return { article: null };  
  },  
  mounted() {  
    this.fetchArticle();  
  },  
  methods: {  
    async fetchArticle() {  
      const res = await axios.get(`/api/articles/${this.articleId}`);  
      this.article = res.data;  
    }  
  }  
};  
</script>  
```

### **3. 商品模块（第 4-5 周）**

#### **3.1 数据库设计（MySQL）**

sql

```sql
-- 用户表  
CREATE TABLE users (  
    id INT AUTO_INCREMENT PRIMARY KEY,  
    username VARCHAR(50) UNIQUE NOT NULL,  
    password_hash VARCHAR(128) NOT NULL,  
    email VARCHAR(100),  
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP  
);  

-- 商品表  
CREATE TABLE products (  
    id INT AUTO_INCREMENT PRIMARY KEY,  
    name VARCHAR(100) NOT NULL,  
    price DECIMAL(10, 2) NOT NULL,  
    stock INT DEFAULT 0,  
    category VARCHAR(50),  
    description TEXT,  
    seller_id INT,  
    FOREIGN KEY (seller_id) REFERENCES users(id)  
);  
```

#### **3.2 购物车逻辑（Vuex）**

javascript

```javascript
// frontend/src/store/cart.js  
const state = {  
  items: JSON.parse(localStorage.getItem('cartItems')) || []  
};  
const mutations = {  
  ADD_TO_CART(state, product) {  
    const existingItem = state.items.find(i => i.id === product.id);  
    if (existingItem) {  
      existingItem.quantity++;  
    } else {  
      state.items.push({ ...product, quantity: 1 });  
    }  
    localStorage.setItem('cartItems', JSON.stringify(state.items));  
  },  
  REMOVE_FROM_CART(state, productId) {  
    state.items = state.items.filter(i => i.id !== productId);  
    localStorage.setItem('cartItems', JSON.stringify(state.items));  
  }  
};  
export default { state, mutations };  
```

## **五、风险管理与应对方案**

### **1. 技术风险**

| **风险场景**     | **预防措施**                                  | **应急方案**                              |
| ---------------- | --------------------------------------------- | ----------------------------------------- |
| 爬虫被封禁       | 降低爬取频率（间隔≥3 秒），使用付费代理 IP    | 切换至手动录入部分数据，优先保证核心字段  |
| 支付接口对接失败 | 提前在沙箱环境测试，保留官方 Demo 代码模板    | 暂时隐藏支付功能，显示 “即将上线” 提示    |
| 数据库性能瓶颈   | 开发阶段使用 EXPLAIN 分析慢查询，添加必要索引 | 临时启用 Redis 全量缓存，逐步优化查询逻辑 |

### **2. 进度风险**

| **风险场景** | **预防措施**                                   | **应急方案**                           |
| ------------ | ---------------------------------------------- | -------------------------------------- |
| 模块开发延期 | 每周预留 1 天缓冲时间，优先实现核心功能（MVP） | 简化非核心功能（如暂不支持第三方登录） |
| 团队协作低效 | 每日 15 分钟站会同步进度，使用 Git 分支管理    | 集中办公解决关键问题，必要时调整分工   |

## **六、交付成果**

### **1. 代码与文档**

- 代码仓库

  - 前端：`https://github.com/ich-creative/frontend`（包含 Vue.js 源码、部署脚本）
- 后端：`https://github.com/ich-creative/backend`（包含 Flask API、数据库模型）
  - 爬虫：`https://github.com/ich-creative/crawler`（Scrapy 项目，含反爬配置）
  
- 技术文档

  - 《技术设计文档》（含数据库 Schema、API 接口列表、部署流程图）
- 《用户操作手册》（含注册 / 购物 / 知识库查询指南）
  - 《管理员运维手册》（含服务器监控、日志排查、紧急回滚步骤）

### **2. 线上成果**

- **前端地址**：`https://www.ich-creative.com`（支持 PC / 移动端，非遗项目浏览与商品购买）
- **管理后台**：`https://admin.ich-creative.com`（管理员数据审核、订单管理，需权限认证）
- **API 文档**：`https://api.ich-creative.com/docs`（Swagger 交互式接口文档，支持在线调试）

## **七、每日时间分配建议**

| **时间段**  | **内容**            | **示例任务**                               |
| ----------- | ------------------- | ------------------------------------------ |
| 9:00-12:00  | 理论学习 + 代码编写 | 学习 Vuex 状态管理，开发购物车添加功能     |
| 14:00-16:00 | 实践调试 + 联调     | 测试用户注册流程，修复接口返回数据格式错误 |
| 19:00-21:00 | 文档整理 + 问题总结 | 编写接口测试用例，记录当日开发日志         |

## **八、资源与工具清单**

### **1. 学习资源**

- **前端**：Vue 官方文档、React 官方教程、《你不知道的 Vue.js》
- **后端**：Flask 官方文档、《Flask Web 开发实战》、JWT 权威指南
- **爬虫**：Scrapy 官方指南、《Python 网络数据采集》、反爬技术博客合集
- **部署**：Docker 入门教程、Nginx 配置最佳实践、Let's Encrypt 证书申请指南

### **2. 开发工具**

- **IDE**：PyCharm（后端）、WebStorm（前端）、VS Code（全栈）
- **数据库**：Navicat（MySQL）、Robo 3T（MongoDB）、MongoDB Compass
- **调试**：Postman（接口测试）、Charles（抓包分析）、浏览器开发者工具
- **协作**：Git（代码管理）、Notion（项目管理）、腾讯文档（多人协作）

